<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>AgriSentinel - Demo</title>
<style>
    body { font-family: Arial, sans-serif; padding: 24px; background: #fff; color: #111; }
    .card { border:1px solid #e6e6e6; padding:16px; border-radius:8px; max-width:820px; }
    img { max-width:100%; height:auto; border:1px solid #ddd; }
    .btn { padding:8px 12px; background:#1976d2; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    input[type=file] { margin-top:8px; }
    .result { margin-top:12px; }
</style>
</head>
<body>
<h2>AgriSentinel â€“ Demo</h2>
<div class="card">
    <p>Upload a drone / field image to compute greenness score and detect stressed regions.</p>
    <input id="file" type="file" accept="image/*" />
    <button class="btn" onclick="upload()">Analyze</button>
    <div id="out" class="result"></div>
</div>

<script>
async function upload(){
    const f = document.getElementById('file').files[0];
    if(!f){ alert('Choose an image first'); return; }
    const form = new FormData();
    form.append('file', f);

    document.getElementById('out').innerHTML = 'Analyzing...';

    try {
        const res = await fetch('/analyze', { method: 'POST', body: form });
        const j = await res.json();

        if(j.error){
            document.getElementById('out').innerText = 'Error: ' + j.error;
            return;
        }

        let html = `<p><b>Greenness score:</b> ${j.greenness_score}</p>`;
        html += `<p><b>Stressed patches:</b> ${j.stressed_patches}</p>`;
        html += `<p><b>Recommendation:</b> ${j.recommendation}</p>`;

        if(j.overlay_image_base64){
            html += `<h3>Overlay Image</h3><img src="data:image/png;base64,${j.overlay_image_base64}" />`;
        }

        document.getElementById('out').innerHTML = html;

    } catch(e){
        document.getElementById('out').innerText = 'Error: ' + e.toString();
    }
}
</script>
</body>
</html>
